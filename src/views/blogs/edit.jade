a(href='/blogs') Back
h1 Edit Clog
form(action='/blogs/edit', method='POST')
	input(type='hidden', id='blog-id', name='blog[id]', value=blog._id.toHexString())
	p
		label(for='post-title') Title:&nbsp;
		input(type='text', id='post-title', name='blog[title]', class='edit-title', value=blog.title)
	p
		label(for='post-date') Publish Date:&nbsp
		input(type='text', id='post-date', name='blog[date]', value=blog.date)
	p
		label(for='post-body') Body:
	p
		textarea(id='post-body', name='blog[body]', class='edit-body')
			#{blog.body}
	p		
		div.selectTags
			label(for='tags') Tags:&nbsp
			input(type='text', id='tags')	
			input(type='hidden', id='selectedTags', name='tag[names]', value=selected)
	p
		ul.tags
			- if (selectedTags)
				each tag in selectedTags
					li.tag
						a(id='remove_tag:' + tag.name, class='remove-tag') x
						#{tag.name}
			
			
	p
		input(type='submit', value='edit')

	- var names = ''
	- for(i=0; i<tagList.length; i++) {
	-		names += '"' + tagList[i].name + '"' + ',' 
	- }

	script		
		$(function() {
			$('#tags').focus(function() {
				$(this).val('');
			});

			function bindRemoveTag () {

				$('a[id^="remove_tag:"]').bind('click', function(event) {

					var tagName = event.target.id.split(':')[1];
					var hdnValue = $('#selectedTags').val();
						
					if (hdnValue) {
						var hdnValueArray = hdnValue.split(',');

						var newHdnValue = '';
						for(i=0;i<hdnValueArray.length;i++) {
							if (hdnValueArray[i] != tagName) {
								newHdnValue += hdnValueArray[i] + ',';
							}
						}

						newHdnValue = newHdnValue.substring(0, newHdnValue.length-1);

						$('#selectedTags').val(newHdnValue);
					} 

					$(this).closest('li').remove();
				});
			}

			bindRemoveTag();

			function addLi (name) {
				var newLi = '<li class="tag"><a id="remove_tag:' + name + '" class="remove-tag">x<a/>' + name + '</li>';
				$('ul.tags').append(newLi);

				bindRemoveTag();
			}

			var searchableTags = [!{names}];
			$('#tags').autocomplete({
				source: searchableTags,
				select: function(event, ui) {
					
					var hdnValue = $('#selectedTags').val();
					
					if (!hdnValue) {
						$('#selectedTags').val(ui.item.value);
						addLi(ui.item.value);
					} else {
						if (hdnValue.indexOf(ui.item.value) == -1) {
							$('#selectedTags').val(hdnValue + ',' + ui.item.value);
							addLi(ui.item.value);
						} 
					}

					return false;
				}
			});
		});
